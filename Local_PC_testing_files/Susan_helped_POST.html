<!-- This file is used to test the .post() function as a local file
The target is http://ec2-52-24-231-219.us-west-2.compute.amazonaws.com/ajaxll.php.
It works very well.
This line in remote PHP file is required to allow post access in Amazon Web Services:
header("Access-Control-Allow-Origin: *");

Susan Liu (LIU Zhonghong) helped to figure out.
-- Duan Liu, 2016-Feb
-->
<html>
<head>
<title>POST Testing</title>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.0/jquery.min.js"></script>
</head>

<body>
<h1>Post Testing</h1><pre>
The object looks like this:

[models]
	[0]
    	[id]: 31,
        [output_text]: "abcd....",
        [output_image]: ""
        
   	[1]
    	[id]: 32,
        [output_text]: "abcd....",
        [output_image]: ""
        
        
	</pre>
<button class="btn btn-large btn-primary">Alert</button>

<button id="BMDS_run_diverge_3" class="btn btn-large btn-primary">Test Run BMDS 3</button>

<div id="show_content"></div>
</body>
</html>

<script type='text/javascript'>
$(document).ready(function(){



var submittion = {
   "submittion-1":"59",
   "submittion-2":"60"
};

var submittion_str = {
    "models": [
        {   
            "id": 31,
            "model_name": "LogLogistic",
            "dfile": "LogLogistic\nBMDS_Model_Run\ntest\noutput.out\n5\n250 1e-08 1e-08 0 1 1 1 0 0\n0.1 0 0.95\n-9999 -9999 -9999\n0\n-9999 -9999 -9999\nDose Incidence NEGATIVE_RESPONSE\n0.000000 0 20\n50.000000 0 20\n150.000000 3 17\n250.000000 6 14\n350.000000 6 14\n"
        },
        {   
            "id": 32,
            "model_name": "LogLogistic",
            "dfile": "LogLogistic\nBMDS_Model_Run\ntest\noutput.out\n5\n250 1e-08 1e-08 0 1 1 1 0 0\n0.1 0 0.95\n-9999 -9999 -9999\n0\n-9999 -9999 -9999\nDose Incidence NEGATIVE_RESPONSE\n0.000000 0 20\n50.000000 0 20\n150.000000 3 17\n250.000000 6 14\n350.000000 6 14\n"
        }
    ]
}





$("#BMDS_run_diverge_3").click(function(e){
	// alert("Clicked");
	$.ajax({url: "http://ec2-52-24-231-219.us-west-2.compute.amazonaws.com/BMDS_execution.php", 
		data: {data: JSON.stringify(submittion_str)},
		// data: 'application/x-www-form-urlencoded; charset=UTF-8', //submittion, 		// Data to send.
		contentType: "text/plain",
		method: "POST",
		// dataType: "application/json",	// The data type to receive. datatype : "application/json",
		cache: false, // The browser not to store content
 		
    	
		success: function(data){
			// alert("success..**");
			
			var obj = JSON.parse(data);
			$("#show_content").html("great, obj.models.toString(): <br>" +
				obj.models.toString()+ 
				"<br> This should work: "+ Object.getOwnPropertyNames(obj.models[0])+
				"<br>Result file: <pre>" + obj.models[0].output_text.toString() +"<pre>");
			// alert(obj.models.toString());
			// alert(Object.getOwnPropertyNames(obj.models[0]));		// problem in this line with '0'
			
			// alert(obj.models.id.0);
			// var obj_string = obj.toString()
			// alert("Success, just data = " + data);
   			// alert("Success, data = " + data.models.id);
			if (obj_string.length>0){
     			$("#retured_content").html(obj_string);
   			} 
    	}
	});
})

}
)

</script>